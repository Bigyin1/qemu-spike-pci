## PCI Spike device

Проект содержит;

1. [PCI устройстово QEMU](./pcidev)
2. [Библиотеку](./spike) для запуска Spike в PCI устройстве.
3. [Программу](./runDevPCI) для взаимодействия в PCI устройством
4. [Тестовую программу](./testprog/) передаваемую PCI.
   

PCI устройство располагает одним регионом памяти в 64 KiB, адрес которого содержится в BAR0.

Карта памяти устройства:
1. [12:64KiB] - память для записи содержимого исполняемого ELF файла.
2. [0:4] - память для записи размера записанного файла. Запись слова в этот регистр приводит к исполнению ранее записанного ELF-а в симуляторе Spike.
3. [4:12] - память, в которой будет содержаться результат работы программы (содержимое регистра a0)


Для сборки проекта используется система Nix. С помощью нее производится сборка initrd для запуска Qemu, а также обустраевается окружение для разработки и сборки Qemu вместе с новым PCI устройством.

Для запуска окружения разработки нужно выполнить ```nix develop```


